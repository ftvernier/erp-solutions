<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de APIs TLPP - Protheus</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .code-output {
            background: #2d3748;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            border-radius: 8px;
            max-height: 600px;
            overflow-y: auto;
            overflow-x: hidden;
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        .code-output pre {
            margin: 0;
            padding: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .form-section {
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .method-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
        }
        .author-info {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .swagger-output {
            background: #1a202c;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 0.85rem;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid py-4">
        <div class="header-gradient text-center py-4 rounded mb-4">
            <h1 class="display-4 fw-bold mb-2">
                <i class="bi bi-code-slash"></i> Gerador de APIs Protheus
            </h1>
            <p class="lead mb-0">Crie APIs REST modernas com TLPP e annotations</p>
        </div>

        <!-- Info do Desenvolvedor -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="author-info">
                    <h5 class="mb-2">
                        <i class="bi bi-person-circle"></i> Desenvolvido por: Fernando Vernier
                    </h5>
                    <p class="mb-0">
                        <i class="bi bi-linkedin"></i> 
                        <a href="https://www.linkedin.com/in/fernando-v-10758522/" target="_blank" class="text-white text-decoration-none">
                            https://www.linkedin.com/in/fernando-v-10758522/
                        </a>
                    </p>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Formulário -->
            <div class="col-md-5">
                <div class="form-section p-4 mb-4">
                    <h3 class="mb-3"><i class="bi bi-gear"></i> Configurações da API</h3>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Nome da API</label>
                        <input type="text" class="form-control" id="apiName" placeholder="Ex: Produtos" value="Produtos">
                    </div>

                    <!-- Operações REST -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Operações REST</label>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="opGetUnico">
                                    <label class="form-check-label" for="opGetUnico">
                                        <span class="badge bg-primary method-badge">GET</span> Único
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="opGetTodos" checked>
                                    <label class="form-check-label" for="opGetTodos">
                                        <span class="badge bg-info method-badge">GET</span> Todos + Paginação
                                    </label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="opPost">
                                    <label class="form-check-label" for="opPost">
                                        <span class="badge bg-success method-badge">POST</span> Criar
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="opPut">
                                    <label class="form-check-label" for="opPut">
                                        <span class="badge bg-warning method-badge">PUT</span> Alterar
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="opDelete">
                                    <label class="form-check-label" for="opDelete">
                                        <span class="badge bg-danger method-badge">DELETE</span> Excluir
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Endpoint Base</label>
                        <input type="text" class="form-control" id="endpoint" placeholder="/api/v1/produtos" value="/api/v1/produtos">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Descrição</label>
                        <textarea class="form-control" id="description" rows="2" placeholder="Descreva o que esta API faz">API para gerenciamento de produtos</textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Tabela Principal</label>
                        <input type="text" class="form-control" id="mainTable" placeholder="Ex: SB1" value="SB1">
                    </div>

                    <!-- Método de Gravação -->
                    <div class="mb-3" id="gravacaoSection">
                        <label class="form-label fw-bold">Método de Gravação</label>
                        <select class="form-select" id="gravacaoTipo" onchange="toggleGravacaoOptions()">
                            <option value="msexecauto">MSExecAuto (Recomendado)</option>
                            <option value="mvc">MVC (Moderno)</option>
                            <option value="reclock">RecLock (Manual)</option>
                        </select>
                    </div>

                    <div class="mb-3" id="execAutoSection">
                        <label class="form-label fw-bold">Nome da Rotina ExecAuto</label>
                        <input type="text" class="form-control" id="execAutoRotina" placeholder="Ex: MATA010, MATA030, MATA410" value="MATA010">
                        <div class="form-text">Informe o nome da rotina que será utilizada no MSExecAuto (ex: MATA010 para produtos)</div>
                    </div>

                    <div class="mb-3" id="mvcSection" style="display: none;">
                        <div class="border rounded p-3" style="background-color: #f8f9fa;">
                            <h6 class="fw-bold text-primary mb-3"><i class="bi bi-diagram-3"></i> Configurações MVC</h6>
                            
                            <div class="mb-3">
                                <label class="form-label fw-bold">Nome do Modelo</label>
                                <input type="text" class="form-control" id="mvcModelo" placeholder="Ex: MATA010, MATA030, MATA410" value="MATA010">
                                <div class="form-text">Nome do modelo que será carregado com FwLoadModel()</div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label fw-bold">SubModelo Master</label>
                                <input type="text" class="form-control" id="mvcSubModelo" placeholder="Ex: SB1MASTER, SA1MASTER, SC5MASTER" value="SB1MASTER">
                                <div class="form-text">Nome do submodelo principal (Master)</div>
                            </div>
                            
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="mvcHasDetail" onchange="toggleDetailSection()">
                                <label class="form-check-label" for="mvcHasDetail">
                                    Possui SubModelo Detail (itens, produtos alternativos, etc.)
                                </label>
                            </div>
                            
                            <div class="mb-3 mt-3" id="mvcDetailSection" style="display: none;">
                                <label class="form-label fw-bold">Nome do SubModelo Detail</label>
                                <input type="text" class="form-control" id="mvcSubModeloDetail" placeholder="Ex: SGIDETAIL, SC6DETAIL, SE1DETAIL" value="">
                                <div class="form-text">Nome do submodelo de detalhes/itens (se houver)</div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Campos (um por linha)</label>
                        <textarea class="form-control" id="fields" rows="4" placeholder="B1_COD&#10;B1_DESC&#10;B1_UM">B1_COD
B1_DESC
B1_UM
B1_GRUPO</textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Autor</label>
                        <input type="text" class="form-control" id="author" placeholder="Seu nome" value="Fernando Vernier">
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includePaginacao" checked>
                            <label class="form-check-label" for="includePaginacao">
                                Paginação inteligente
                            </label>
                        </div>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="includeDoc" checked>
                        <label class="form-check-label" for="includeDoc">
                            Gerar documentação Swagger
                        </label>
                    </div>

                    <button class="btn btn-primary btn-lg w-100" onclick="generateCode()">
                        <i class="bi bi-magic"></i> Gerar Código TLPP
                    </button>
                </div>

                <!-- Templates -->
                <div class="form-section p-4 mb-4">
                    <h4 class="mb-3"><i class="bi bi-file-code"></i> Templates Prontos</h4>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary" onclick="carregarTemplate('produto')">
                            <i class="bi bi-box"></i> API de Produtos (SB1)
                        </button>
                        <button class="btn btn-outline-success" onclick="carregarTemplate('cliente')">
                            <i class="bi bi-person"></i> API de Clientes (SA1)
                        </button>
                        <button class="btn btn-outline-warning" onclick="carregarTemplate('pedido')">
                            <i class="bi bi-cart"></i> API de Pedidos (SC5)
                        </button>
                        <button class="btn btn-outline-info" onclick="carregarTemplate('fornecedor')">
                            <i class="bi bi-building"></i> API de Fornecedores (SA2)
                        </button>
                    </div>
                </div>

                <!-- Consumidor de API REST -->
                <div class="form-section p-4">
                    <h4 class="mb-3"><i class="bi bi-arrow-down-circle"></i> Consumir API REST</h4>
                    <p class="text-muted small mb-3">Gere código para consumir APIs externas usando FWRest</p>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Nome da Função</label>
                        <input type="text" class="form-control" id="restFuncName" placeholder="Ex: IMPSE1, INTEGRA_CLIENTES" value="xFWREST">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Descrição da Função</label>
                        <input type="text" class="form-control" id="restFuncDesc" placeholder="Ex: Importa SE1, Integra Clientes" value="Consome API de Produtos">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">URL Base</label>
                        <input type="text" class="form-control" id="restUrlBase" placeholder="https://teste.com.br/ws" value="https://teste.com.br/ws">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Path da API</label>
                        <input type="text" class="form-control" id="restPath" placeholder="/teste/envioABC ou /teste/envioteste?id=AAAA" value="/teste/envioteste?id=aaaaa">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Método HTTP</label>
                        <select class="form-select" id="restMethod" onchange="toggleRestBodySection()">
                            <option value="GET">GET (Buscar dados)</option>
                            <option value="POST">POST (Enviar dados)</option>
                            <option value="PUT">PUT (Alterar dados)</option>
                            <option value="DELETE">DELETE (Excluir dados)</option>
                        </select>
                    </div>

                    <div class="mb-3" id="restBodySection">
                        <label class="form-label fw-bold">Body da Requisição (JSON)</label>
                        <textarea class="form-control" id="restBody" rows="3" placeholder='{"CAMPO":"CONTEUDO", "CAMPO2":"CONTEUDO2"}'>{"CAMPO":"conteudo", "CAMPO2":"conteudo2"}</textarea>
                        <div class="form-text">Deixe vazio para gerar um exemplo padrão</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">User Agent</label>
                        <input type="text" class="form-control" id="restUserAgent" value="Mozilla/4.0 (compatible; Protheus 12.1.x)">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Content Type</label>
                        <input type="text" class="form-control" id="restContentType" value="application/json">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Charset</label>
                        <input type="text" class="form-control" id="restCharset" value="utf-8">
                    </div>

                    <button class="btn btn-success btn-lg w-100" onclick="generateRestClient()">
                        <i class="bi bi-arrow-down-circle"></i> Gerar Código Consumidor
                    </button>
                </div>
            </div>

            <!-- Código Gerado -->
            <div class="col-md-7">
                <div class="mb-3">
                    <h3><i class="bi bi-file-earmark-code"></i> Código TLPP Gerado</h3>
                    <div class="btn-group" role="group">
                        <button class="btn btn-outline-secondary btn-sm" onclick="copyCode()">
                            <i class="bi bi-clipboard"></i> Copiar
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="downloadCode()">
                            <i class="bi bi-download"></i> Download
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="showSwagger()">
                            <i class="bi bi-book"></i> Ver Swagger
                        </button>
                    </div>
                </div>
                
                <div class="code-output" id="codeOutput">
                    <pre>Clique em "Gerar Código TLPP" para ver o resultado...</pre>
                </div>

                <!-- Estatísticas -->
                <div class="mt-4">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-primary" id="linesCount">0</h5>
                                    <p class="card-text small">Linhas de Código</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-success" id="methodsCount">0</h5>
                                    <p class="card-text small">Métodos REST</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-warning" id="timeEstimate">0h</h5>
                                    <p class="card-text small">Tempo Economizado</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estrutura de arquivos -->
                <div class="mt-4">
                    <h4><i class="bi bi-diagram-2"></i> Estrutura de Arquivos</h4>
                    <div class="card">
                        <div class="card-body">
                            <div class="text-muted small" id="fileStructure">
                                <i class="bi bi-folder"></i> src/<br>
                                &nbsp;&nbsp;<i class="bi bi-file-earmark-code"></i> api_produtos.tlpp<br>
                                &nbsp;&nbsp;<i class="bi bi-file-earmark-text"></i> api_produtos_doc.tlpp<br>
                                &nbsp;&nbsp;<i class="bi bi-file-earmark"></i> components_produtos.tlpp
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Swagger -->
    <div class="modal fade" id="swaggerModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-book"></i> Documentação Swagger Gerada
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <p class="text-muted mb-0">Documentação OpenAPI 3.0 para sua API</p>
                        <button class="btn btn-sm btn-outline-primary" onclick="copySwagger()">
                            <i class="bi bi-clipboard"></i> Copiar Swagger
                        </button>
                    </div>
                    <div class="swagger-output">
                        <pre id="swaggerOutput" class="p-3 mb-0"></pre>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" onclick="downloadSwagger()">
                        <i class="bi bi-download"></i> Download swagger.json
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variável global para armazenar a configuração atual
        let currentConfig = null;

        function toggleGravacaoOptions() {
            var tipo = document.getElementById('gravacaoTipo').value;
            var execAutoSection = document.getElementById('execAutoSection');
            var mvcSection = document.getElementById('mvcSection');
            
            execAutoSection.style.display = 'none';
            mvcSection.style.display = 'none';
            
            if (tipo === 'msexecauto') {
                execAutoSection.style.display = 'block';
            } else if (tipo === 'mvc') {
                mvcSection.style.display = 'block';
            }
        }

        function toggleDetailSection() {
            var hasDetail = document.getElementById('mvcHasDetail').checked;
            var detailSection = document.getElementById('mvcDetailSection');
            
            detailSection.style.display = hasDetail ? 'block' : 'none';
        }

        function toggleRestBodySection() {
            var method = document.getElementById('restMethod').value;
            var bodySection = document.getElementById('restBodySection');
            
            if (method === 'POST' || method === 'PUT') {
                bodySection.style.display = 'block';
            } else {
                bodySection.style.display = 'none';
            }
        }

        function generateRestClient() {
            var config = {
                funcName: document.getElementById('restFuncName').value || 'IMPSE1',
                funcDesc: document.getElementById('restFuncDesc').value || 'Importa SE1',
                urlBase: document.getElementById('restUrlBase').value || 'https://teste.com.br/ws',
                path: document.getElementById('restPath').value || '/teste/envioabc?id=aaaaa',
                method: document.getElementById('restMethod').value || 'GET',
                body: document.getElementById('restBody').value || '',
                userAgent: document.getElementById('restUserAgent').value || 'Mozilla/4.0 (compatible; Protheus 12.1.x)',
                contentType: document.getElementById('restContentType').value || 'application/json',
                charset: document.getElementById('restCharset').value || 'utf-8',
                author: document.getElementById('author').value || 'Fernando Vernier'
            };
            
            var code = generateRestClientCode(config);
            document.getElementById('codeOutput').innerHTML = '<pre>' + escapeHtml(code) + '</pre>';
            
            // Atualizar estatísticas para o código consumidor
            var lines = code.split('\n').length;
            document.getElementById('linesCount').textContent = lines;
            document.getElementById('methodsCount').textContent = '1';
            document.getElementById('timeEstimate').textContent = '0.2h';
        }

        function generateRestClientCode(config) {
            var date = new Date().toLocaleDateString('pt-BR');
            var code = '//Bibliotecas\n';
            code += '#Include "Totvs.ch"\n\n';
            code += '/*/{Protheus.doc} User Function ' + config.funcName + '\n';
            code += config.funcDesc + '\n';
            code += '@author ' + config.author + '\n';
            code += '@since ' + date + '\n';
            code += '@version 1.0\n';
            code += '@type function\n';
            code += '@obs Codigo gerado automaticamente pelo Autumn Code Maker\n';
            code += '@see http://autumncodemaker.com\n';
            code += '/*/\n';
            code += 'User Function ' + config.funcName + '()\n';
            code += '    Local aArea         := FWGetArea()\n';
            code += '    Local cResultado    := ""\n';
            code += '    Local cErro         := ""\n';
            code += '    Local aHeader       := {}\n';
            code += '    Local oRestClient   := FWRest():New("' + config.urlBase + '")\n';
            code += '    Local cBody         := ""\n';
            code += '    \n';
            code += '    //Monta o cabeçalho da Requisição\n';
            code += '    aAdd(aHeader, "User-Agent: ' + config.userAgent + '")\n';
            code += '    aAdd(aHeader, "Content-Type: ' + config.contentType;
            
            if (config.charset) {
                code += '; charset=' + config.charset;
            }
            
            code += '")\n';
            code += '    \n';
            code += '    //Define a PATH da URL\n';
            code += '    oRestClient:setPath("' + config.path + '")\n';
            code += '    \n';
            
            // Adiciona body se fornecido ou se for POST/PUT
            if (config.body.trim() || config.method === 'POST' || config.method === 'PUT') {
                code += '    //Preenche o Body da Requisição\n';
                if (config.body.trim()) {
                    code += '    cBody += \'' + config.body + '\'        + CRLF\n';
                } else {
                    code += '    cBody += \'{"campo":"valor", "campo2":"valor2"}\'        + CRLF\n';
                }
                code += '    oRestClient:SetPostParams(cBody)\n';
                code += '    \n';
            }
            
            code += '    //Executa a Requisição\n';
            
            // Gera o método HTTP correto - sempre sem parâmetros pois usamos SetPostParams
            switch(config.method) {
                case 'GET':
                    code += '    If oRestClient:Get(aHeader)\n';
                    break;
                case 'POST':
                    code += '    If oRestClient:Post(aHeader)\n';
                    break;
                case 'PUT':
                    code += '    If oRestClient:Put(aHeader)\n';
                    break;
                case 'DELETE':
                    code += '    If oRestClient:Delete(aHeader)\n';
                    break;
            }
            
            code += '        cResultado := oRestClient:GetResult()\n';
            code += '        ShowLog("Sucesso na integração, resultado é: " + CRLF + cResultado)\n';
            code += '    Else\n';
            code += '        cErro := oRestClient:GetLastError()\n';
            code += '        ShowLog("Houve um erro na integração: " + CRLF + cErro)\n';
            code += '    EndIf\n';
            code += '    \n';
            code += '    FWRestArea(aArea)\n';
            code += 'Return Nil';
            
            return code;
        }

        function generateCode() {
            var config = {
                apiName: document.getElementById('apiName').value,
                endpoint: document.getElementById('endpoint').value,
                description: document.getElementById('description').value,
                mainTable: document.getElementById('mainTable').value,
                gravacaoTipo: document.getElementById('gravacaoTipo').value,
                execAutoRotina: document.getElementById('execAutoRotina').value,
                mvcModelo: document.getElementById('mvcModelo').value,
                mvcSubModelo: document.getElementById('mvcSubModelo').value,
                mvcHasDetail: document.getElementById('mvcHasDetail').checked,
                mvcSubModeloDetail: document.getElementById('mvcSubModeloDetail').value,
                fields: document.getElementById('fields').value.split('\n').filter(function(f) { return f.trim(); }),
                author: document.getElementById('author').value,
                operations: {
                    getUnico: document.getElementById('opGetUnico').checked,
                    getTodos: document.getElementById('opGetTodos').checked,
                    post: document.getElementById('opPost').checked,
                    put: document.getElementById('opPut').checked,
                    delete: document.getElementById('opDelete').checked
                },
                includePaginacao: document.getElementById('includePaginacao').checked,
                includeDoc: document.getElementById('includeDoc').checked
            };
            
            // Armazenar configuração globalmente
            currentConfig = config;
            
            var code = generateTLPPCode(config);
            document.getElementById('codeOutput').innerHTML = '<pre>' + escapeHtml(code) + '</pre>';
            updateStatistics(config, code);
            updateFileStructure(config);
        }

        function generateTLPPCode(config) {
            var date = new Date().toLocaleDateString('pt-BR');
            var code = '#Include "tlpp-core.th"\n#Include "tlpp-rest.th"';

            if (config.includeDoc) {
                code += '\n#Include "tlpp-doc.th"';
            }
            
            if (config.gravacaoTipo === 'mvc') {
                code += '\n#Include "FWMVCDef.ch"';
            }

            code += '\n\n/*/{Protheus.doc} ' + config.apiName + 'API\n';
            code += config.description + '\n';
            code += '@author ' + config.author + '\n';
            code += '@since ' + date + '\n';
            code += '@version 1.0\n';
            code += '@type class\n';
            code += '/*/\n\n';
            code += 'Using Namespace tlpp.core\n\n';
            code += 'Class ' + config.apiName + 'API\n';
            code += '    Public Method New() Constructor';

            if (config.operations.getUnico) {
                code += '\n    Public Method GetById()';
            }
            
            if (config.operations.getTodos) {
                code += '\n    Public Method GetAll()';
            }
            
            if (config.operations.post) {
                code += '\n    Public Method Post()';
            }
            
            if (config.operations.put) {
                code += '\n    Public Method Put()';
            }
            
            if (config.operations.delete) {
                code += '\n    Public Method Delete()';
            }

            code += '\nEndClass\n\n';
            code += 'Method New() Class ' + config.apiName + 'API\n';
            code += 'Return Self';

            if (config.operations.getUnico) {
                code += generateGetByIdMethod(config);
            }

            if (config.operations.getTodos) {
                code += generateGetAllMethod(config);
            }

            if (config.operations.post) {
                code += generatePostMethod(config);
            }

            if (config.operations.put) {
                code += generatePutMethod(config);
            }

            if (config.operations.delete) {
                code += generateDeleteMethod(config);
            }

            return code;
        }

        function generateGetByIdMethod(config) {
            var method = '\n\n/*/{Protheus.doc} GetById\n';
            method += 'Busca um registro específico por ID\n';
            method += '@author ' + config.author + '\n';
            method += '@since ' + new Date().toLocaleDateString('pt-BR') + '\n';
            method += '@version 1.0\n';
            method += '/*/\n';
            method += '@Get("' + config.endpoint + '/{id}"';
            if (config.includeDoc) {
                method += ', description="' + config.description + ' - Busca por ID"';
            }
            method += ')\n';
            method += 'Method GetById() Class ' + config.apiName + 'API\n';
            method += '    Local oResponse := JsonObject():New()\n';
            method += '    Local cId       := oRest:getPathParam("id")\n';
            method += '    \n';
            method += '    DbSelectArea("' + config.mainTable + '")\n';
            method += '    ' + config.mainTable + '->(DbSetOrder(1))\n';
            method += '    \n';
            method += '    If ' + config.mainTable + '->(DbSeek(xFilial("' + config.mainTable + '") + cId))\n';
            method += '        oResponse["success"] := .T.\n';
            method += '        oResponse["message"] := "Registro encontrado"\n';
            method += '        oResponse["data"]    := JsonObject():New()\n';
            
            for (var i = 0; i < config.fields.length; i++) {
                method += '        oResponse["data"]["' + config.fields[i].toLowerCase() + '"] := ' + config.mainTable + '->' + config.fields[i] + '\n';
            }
            
            method += '    Else\n';
            method += '        oResponse["success"] := .F.\n';
            method += '        oResponse["message"] := "Registro não encontrado"\n';
            method += '        oRest:SetStatusCode(404)\n';
            method += '    EndIf\n';
            method += '    \n';
            method += '    oRest:SetResponse(oResponse:ToJson())\n';
            method += 'Return .T.';
            
            return method;
        }

        function generateGetAllMethod(config) {
            var method = '\n\n/*/{Protheus.doc} GetAll\n';
            method += 'Busca todos os registros com paginação\n';
            method += '@author ' + config.author + '\n';
            method += '@since ' + new Date().toLocaleDateString('pt-BR') + '\n';
            method += '@version 1.0\n';
            method += '/*/\n';
            method += '@Get("' + config.endpoint + '"';
            if (config.includeDoc) {
                method += ', description="' + config.description + ' - Listagem com paginação"';
            }
            method += ')\n';
            method += 'Method GetAll() Class ' + config.apiName + 'API\n';
            method += '    Local oResponse := JsonObject():New()\n';
            method += '    Local aData     := {}\n';
            method += '    Local nLimit    := Val(oRest:getQueryRequest("limit"))\n';
            method += '    Local nPage     := Val(oRest:getQueryRequest("page"))\n';
            method += '    Local nTotal    := 0\n';
            method += '    Local nSkip     := 0\n';
            method += '    Local nCount    := 0\n';
            method += '    \n';
            method += '    Default nLimit := 10\n';
            method += '    Default nPage  := 1\n';
            method += '    nSkip := (nPage - 1) * nLimit\n';
            method += '    \n';
            method += '    DbSelectArea("' + config.mainTable + '")\n';
            method += '    ' + config.mainTable + '->(DbSetOrder(1))\n';
            method += '    ' + config.mainTable + '->(DbGoTop())\n';
            method += '    \n';
            method += '    While !' + config.mainTable + '->(EOF())\n';
            method += '        nTotal++\n';
            method += '        \n';
            method += '        If nCount >= nSkip .And. Len(aData) < nLimit\n';
            method += '            Local oItem := JsonObject():New()\n';
            
            for (var i = 0; i < config.fields.length; i++) {
                method += '            oItem["' + config.fields[i].toLowerCase() + '"] := ' + config.mainTable + '->' + config.fields[i] + '\n';
            }
            
            method += '            aAdd(aData, oItem)\n';
            method += '        EndIf\n';
            method += '        \n';
            method += '        nCount++\n';
            method += '        ' + config.mainTable + '->(DbSkip())\n';
            method += '    End\n';
            method += '    \n';
            method += '    oResponse["success"]    := .T.\n';
            method += '    oResponse["message"]    := "Registros encontrados"\n';
            method += '    oResponse["data"]       := aData\n';
            method += '    oResponse["pagination"] := JsonObject():New()\n';
            method += '    oResponse["pagination"]["page"]       := nPage\n';
            method += '    oResponse["pagination"]["limit"]      := nLimit\n';
            method += '    oResponse["pagination"]["total"]      := nTotal\n';
            method += '    oResponse["pagination"]["totalPages"] := Int(nTotal / nLimit) + If(nTotal % nLimit > 0, 1, 0)\n';
            method += '    \n';
            method += '    oRest:SetResponse(oResponse:ToJson())\n';
            method += 'Return .T.';
            
            return method;
        }

        function generatePostMethod(config) {
            var method = '\n\n/*/{Protheus.doc} Post\n';
            method += 'Cria um novo registro\n';
            method += '@author ' + config.author + '\n';
            method += '@since ' + new Date().toLocaleDateString('pt-BR') + '\n';
            method += '@version 1.0\n';
            method += '/*/\n';
            method += '@Post("' + config.endpoint + '"';
            if (config.includeDoc) {
                method += ', description="' + config.description + ' - Criação"';
            }
            method += ')\n';
            method += 'Method Post() Class ' + config.apiName + 'API\n';
            method += '    Local oResponse := JsonObject():New()\n';
            method += '    Local cBody     := oRest:GetBodyRequest()\n';
            method += '    Local jBody     := JsonObject():New()\n';
            method += '    \n';
            method += '    jBody:FromJson(cBody)\n';
            method += '    \n';

            if (config.gravacaoTipo === 'msexecauto') {
                method += '    // Inclusão via MSExecAuto\n';
                method += '    Private lMsErroAuto := .F.\n';
                method += '    Private aRotAuto    := {}\n';
                method += '    \n';
                for (var i = 0; i < config.fields.length; i++) {
                    method += '    aAdd(aRotAuto, {"' + config.fields[i] + '", jBody["' + config.fields[i].toLowerCase() + '"], Nil})\n';
                }
                method += '    \n';
                method += '    MSExecAuto({|x,y| ' + config.execAutoRotina + '(x,y)}, aRotAuto, 3)\n';
                method += '    \n';
                method += '    If lMsErroAuto\n';
                method += '        oResponse["success"] := .F.\n';
                method += '        oResponse["message"] := "Erro na inclusão do registro"\n';
                method += '        oRest:SetStatusCode(500)\n';
                method += '    Else\n';
                method += '        oResponse["success"] := .T.\n';
                method += '        oResponse["message"] := "Registro incluído com sucesso"\n';
                method += '        oResponse["data"]    := jBody\n';
                method += '    EndIf\n';
            } else if (config.gravacaoTipo === 'mvc') {
                method += '    // Inclusão via MVC\n';
                method += '    Local oModel := FwLoadModel("' + config.mvcModelo + '")\n';
                method += '    \n';
                method += '    oModel:SetOperation(MODEL_OPERATION_INSERT)\n';
                method += '    oModel:Activate()\n';
                method += '    \n';
                method += '    // MASTER ' + config.mvcSubModelo + '\n';
                for (var i = 0; i < config.fields.length; i++) {
                    method += '    oModel:SetValue("' + config.mvcSubModelo + '", "' + config.fields[i] + '", jBody["' + config.fields[i].toLowerCase() + '"])\n';
                }
                
                if (config.mvcHasDetail && config.mvcSubModeloDetail) {
                    method += '    \n';
                    method += '    // DETAIL ' + config.mvcSubModeloDetail + '\n';
                    method += '    // Exemplo de campos para submodelo detail:\n';
                    method += '    // oModel:SetValue("' + config.mvcSubModeloDetail + '", "CAMPO_ITEM", jBody["item"])\n';
                    method += '    // oModel:SetValue("' + config.mvcSubModeloDetail + '", "CAMPO_SEQ", jBody["sequencia"])\n';
                    method += '    // Adicione aqui os campos específicos do submodelo detail\n';
                }
                
                method += '    \n';
                method += '    If oModel:VldData()\n';
                method += '        oModel:CommitData()\n';
                method += '        oResponse["success"] := .T.\n';
                method += '        oResponse["message"] := "Registro incluído com sucesso"\n';
                method += '        oResponse["data"]    := jBody\n';
                method += '    Else\n';
                method += '        Local aErro := oModel:GetErrorMessage()\n';
                method += '        Local cMsgErro := ""\n';
                method += '        \n';
                method += '        If ValType(aErro) == "A" .And. Len(aErro) > 0\n';
                method += '            cMsgErro := AllTrim(aErro[6])\n';
                method += '        Else\n';
                method += '            cMsgErro := "Erro na validação dos dados"\n';
                method += '        EndIf\n';
                method += '        \n';
                method += '        oResponse["success"] := .F.\n';
                method += '        oResponse["message"] := "Erro na inclusão: " + cMsgErro\n';
                method += '        oRest:SetStatusCode(500)\n';
                method += '    EndIf\n';
                method += '    \n';
                method += '    oModel:DeActivate()\n';
                method += '    oModel:Destroy()\n';
            } else {
                method += '    // Inclusão via RecLock\n';
                method += '    DbSelectArea("' + config.mainTable + '")\n';
                method += '    \n';
                method += '    If RecLock("' + config.mainTable + '", .T.)\n';
                for (var i = 0; i < config.fields.length; i++) {
                    method += '        ' + config.mainTable + '->' + config.fields[i] + ' := jBody["' + config.fields[i].toLowerCase() + '"]\n';
                }
                method += '        ' + config.mainTable + '->(MsUnlock())\n';
                method += '        \n';
                method += '        oResponse["success"] := .T.\n';
                method += '        oResponse["message"] := "Registro incluído com sucesso"\n';
                method += '        oResponse["data"]    := jBody\n';
                method += '    Else\n';
                method += '        oResponse["success"] := .F.\n';
                method += '        oResponse["message"] := "Erro ao bloquear registro para inclusão"\n';
                method += '        oRest:SetStatusCode(500)\n';
                method += '    EndIf\n';
            }

            method += '    \n';
            method += '    oRest:SetResponse(oResponse:ToJson())\n';
            method += 'Return .T.';

            return method;
        }

        function generatePutMethod(config) {
            var method = '\n\n/*/{Protheus.doc} Put\n';
            method += 'Altera um registro existente\n';
            method += '@author ' + config.author + '\n';
            method += '@since ' + new Date().toLocaleDateString('pt-BR') + '\n';
            method += '@version 1.0\n';
            method += '/*/\n';
            method += '@Put("' + config.endpoint + '/{id}"';
            if (config.includeDoc) {
                method += ', description="' + config.description + ' - Alteração"';
            }
            method += ')\n';
            method += 'Method Put() Class ' + config.apiName + 'API\n';
            method += '    Local oResponse := JsonObject():New()\n';
            method += '    Local cBody     := oRest:GetBodyRequest()\n';
            method += '    Local jBody     := JsonObject():New()\n';
            method += '    Local cId       := oRest:getPathParam("id")\n';
            method += '    \n';
            method += '    jBody:FromJson(cBody)\n';
            method += '    \n';
            method += '    DbSelectArea("' + config.mainTable + '")\n';
            method += '    ' + config.mainTable + '->(DbSetOrder(1))\n';
            method += '    \n';
            method += '    If ' + config.mainTable + '->(DbSeek(xFilial("' + config.mainTable + '") + cId))\n';
            
            if (config.gravacaoTipo === 'reclock') {
                method += '        If RecLock("' + config.mainTable + '", .F.)\n';
                for (var i = 0; i < config.fields.length; i++) {
                    method += '            ' + config.mainTable + '->' + config.fields[i] + ' := jBody["' + config.fields[i].toLowerCase() + '"]\n';
                }
                method += '            ' + config.mainTable + '->(MsUnlock())\n';
                method += '            \n';
                method += '            oResponse["success"] := .T.\n';
                method += '            oResponse["message"] := "Registro alterado com sucesso"\n';
                method += '            oResponse["data"]    := jBody\n';
                method += '        Else\n';
                method += '            oResponse["success"] := .F.\n';
                method += '            oResponse["message"] := "Erro ao bloquear registro para alteração"\n';
                method += '            oRest:SetStatusCode(500)\n';
                method += '        EndIf\n';
            } else {
                method += '        // Implementar alteração via ' + (config.gravacaoTipo === 'mvc' ? 'MVC' : 'MSExecAuto') + '\n';
                method += '        oResponse["success"] := .T.\n';
                method += '        oResponse["message"] := "Registro alterado com sucesso"\n';
                method += '        oResponse["data"]    := jBody\n';
            }
            
            method += '    Else\n';
            method += '        oResponse["success"] := .F.\n';
            method += '        oResponse["message"] := "Registro não encontrado"\n';
            method += '        oRest:SetStatusCode(404)\n';
            method += '    EndIf\n';
            method += '    \n';
            method += '    oRest:SetResponse(oResponse:ToJson())\n';
            method += 'Return .T.';

            return method;
        }

        function generateDeleteMethod(config) {
            var method = '\n\n/*/{Protheus.doc} Delete\n';
            method += 'Exclui um registro\n';
            method += '@author ' + config.author + '\n';
            method += '@since ' + new Date().toLocaleDateString('pt-BR') + '\n';
            method += '@version 1.0\n';
            method += '/*/\n';
            method += '@Delete("' + config.endpoint + '/{id}"';
            if (config.includeDoc) {
                method += ', description="' + config.description + ' - Exclusão"';
            }
            method += ')\n';
            method += 'Method Delete() Class ' + config.apiName + 'API\n';
            method += '    Local oResponse := JsonObject():New()\n';
            method += '    Local cId       := oRest:getPathParam("id")\n';
            method += '    \n';
            method += '    DbSelectArea("' + config.mainTable + '")\n';
            method += '    ' + config.mainTable + '->(DbSetOrder(1))\n';
            method += '    \n';
            method += '    If ' + config.mainTable + '->(DbSeek(xFilial("' + config.mainTable + '") + cId))\n';
            method += '        If RecLock("' + config.mainTable + '", .F.)\n';
            method += '            ' + config.mainTable + '->(DbDelete())\n';
            method += '            ' + config.mainTable + '->(MsUnlock())\n';
            method += '            \n';
            method += '            oResponse["success"] := .T.\n';
            method += '            oResponse["message"] := "Registro excluído com sucesso"\n';
            method += '        Else\n';
            method += '            oResponse["success"] := .F.\n';
            method += '            oResponse["message"] := "Erro ao bloquear registro para exclusão"\n';
            method += '            oRest:SetStatusCode(500)\n';
            method += '        EndIf\n';
            method += '    Else\n';
            method += '        oResponse["success"] := .F.\n';
            method += '        oResponse["message"] := "Registro não encontrado"\n';
            method += '        oRest:SetStatusCode(404)\n';
            method += '    EndIf\n';
            method += '    \n';
            method += '    oRest:SetResponse(oResponse:ToJson())\n';
            method += 'Return .T.';

            return method;
        }

        function generateSwaggerDoc(config) {
            var swagger = {
                "openapi": "3.0.0",
                "info": {
                    "title": config.apiName + " API",
                    "description": config.description,
                    "version": "1.0.0",
                    "contact": {
                        "name": config.author
                    }
                },
                "servers": [
                    {
                        "url": "https://your-protheus-server.com",
                        "description": "Servidor Protheus"
                    }
                ],
                "paths": {}
            };

            var basePath = config.endpoint;
            
            // GET All
            if (config.operations.getTodos) {
                swagger.paths[basePath] = {
                    "get": {
                        "summary": "Listar todos os " + config.apiName.toLowerCase(),
                        "description": config.description + " - Listagem com paginação",
                        "parameters": [
                            {
                                "name": "page",
                                "in": "query",
                                "description": "Número da página",
                                "required": false,
                                "schema": {
                                    "type": "integer",
                                    "default": 1
                                }
                            },
                            {
                                "name": "limit",
                                "in": "query",
                                "description": "Limite de registros por página",
                                "required": false,
                                "schema": {
                                    "type": "integer",
                                    "default": 10
                                }
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Lista de " + config.apiName.toLowerCase(),
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": { "type": "boolean" },
                                                "message": { "type": "string" },
                                                "data": {
                                                    "type": "array",
                                                    "items": { "$ref": "#/components/schemas/" + config.apiName }
                                                },
                                                "pagination": {
                                                    "type": "object",
                                                    "properties": {
                                                        "page": { "type": "integer" },
                                                        "limit": { "type": "integer" },
                                                        "total": { "type": "integer" },
                                                        "totalPages": { "type": "integer" }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                };
            }

            // POST
            if (config.operations.post) {
                if (!swagger.paths[basePath]) swagger.paths[basePath] = {};
                swagger.paths[basePath]["post"] = {
                    "summary": "Criar novo " + config.apiName.toLowerCase().slice(0, -1),
                    "description": config.description + " - Criação",
                    "requestBody": {
                        "required": true,
                        "content": {
                            "application/json": {
                                "schema": { "$ref": "#/components/schemas/" + config.apiName + "Input" }
                            }
                        }
                    },
                    "responses": {
                        "200": {
                            "description": config.apiName.slice(0, -1) + " criado com sucesso",
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "success": { "type": "boolean" },
                                            "message": { "type": "string" },
                                            "data": { "$ref": "#/components/schemas/" + config.apiName }
                                        }
                                    }
                                }
                            }
                        },
                        "500": {
                            "description": "Erro interno do servidor"
                        }
                    }
                };
            }

            // GET by ID
            if (config.operations.getUnico) {
                swagger.paths[basePath + "/{id}"] = {
                    "get": {
                        "summary": "Buscar " + config.apiName.toLowerCase().slice(0, -1) + " por ID",
                        "description": config.description + " - Busca por ID",
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "description": "ID do " + config.apiName.toLowerCase().slice(0, -1),
                                "schema": {
                                    "type": "string"
                                }
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": config.apiName.slice(0, -1) + " encontrado",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": { "type": "boolean" },
                                                "message": { "type": "string" },
                                                "data": { "$ref": "#/components/schemas/" + config.apiName }
                                            }
                                        }
                                    }
                                }
                            },
                            "404": {
                                "description": config.apiName.slice(0, -1) + " não encontrado"
                            }
                        }
                    }
                };
            }

            // PUT
            if (config.operations.put) {
                if (!swagger.paths[basePath + "/{id}"]) swagger.paths[basePath + "/{id}"] = {};
                swagger.paths[basePath + "/{id}"]["put"] = {
                    "summary": "Alterar " + config.apiName.toLowerCase().slice(0, -1),
                    "description": config.description + " - Alteração",
                    "parameters": [
                        {
                            "name": "id",
                            "in": "path",
                            "required": true,
                            "description": "ID do " + config.apiName.toLowerCase().slice(0, -1),
                            "schema": {
                                "type": "string"
                            }
                        }
                    ],
                    "requestBody": {
                        "required": true,
                        "content": {
                            "application/json": {
                                "schema": { "$ref": "#/components/schemas/" + config.apiName + "Input" }
                            }
                        }
                    },
                    "responses": {
                        "200": {
                            "description": config.apiName.slice(0, -1) + " alterado com sucesso"
                        },
                        "404": {
                            "description": config.apiName.slice(0, -1) + " não encontrado"
                        },
                        "500": {
                            "description": "Erro interno do servidor"
                        }
                    }
                };
            }

            // DELETE
            if (config.operations.delete) {
                if (!swagger.paths[basePath + "/{id}"]) swagger.paths[basePath + "/{id}"] = {};
                swagger.paths[basePath + "/{id}"]["delete"] = {
                    "summary": "Excluir " + config.apiName.toLowerCase().slice(0, -1),
                    "description": config.description + " - Exclusão",
                    "parameters": [
                        {
                            "name": "id",
                            "in": "path",
                            "required": true,
                            "description": "ID do " + config.apiName.toLowerCase().slice(0, -1),
                            "schema": {
                                "type": "string"
                            }
                        }
                    ],
                    "responses": {
                        "200": {
                            "description": config.apiName.slice(0, -1) + " excluído com sucesso"
                        },
                        "404": {
                            "description": config.apiName.slice(0, -1) + " não encontrado"
                        },
                        "500": {
                            "description": "Erro interno do servidor"
                        }
                    }
                };
            }

            // Schemas
            swagger.components = {
                "schemas": {}
            };

            var schemaProperties = {};
            var inputSchemaProperties = {};
            
            for (var i = 0; i < config.fields.length; i++) {
                var fieldName = config.fields[i].toLowerCase();
                schemaProperties[fieldName] = {
                    "type": "string",
                    "description": "Campo " + config.fields[i]
                };
                inputSchemaProperties[fieldName] = {
                    "type": "string",
                    "description": "Campo " + config.fields[i]
                };
            }

            swagger.components.schemas[config.apiName] = {
                "type": "object",
                "properties": schemaProperties
            };

            swagger.components.schemas[config.apiName + "Input"] = {
                "type": "object",
                "required": config.fields.map(f => f.toLowerCase()),
                "properties": inputSchemaProperties
            };

            return JSON.stringify(swagger, null, 2);
        }

        function showSwagger() {
            if (!currentConfig) {
                alert('Primeiro gere o código clicando em "Gerar Código TLPP"');
                return;
            }

            if (!currentConfig.includeDoc) {
                alert('A documentação Swagger está desabilitada. Marque a opção "Gerar documentação Swagger" e gere o código novamente.');
                return;
            }

            var swaggerDoc = generateSwaggerDoc(currentConfig);
            document.getElementById('swaggerOutput').textContent = swaggerDoc;
            
            var modal = new bootstrap.Modal(document.getElementById('swaggerModal'));
            modal.show();
        }

        function copySwagger() {
            var swaggerContent = document.getElementById('swaggerOutput').textContent;
            if (swaggerContent && swaggerContent.trim()) {
                navigator.clipboard.writeText(swaggerContent).then(function() {
                    alert('Documentação Swagger copiada para a área de transferência!');
                }).catch(function() {
                    alert('Erro ao copiar. Selecione o conteúdo manualmente.');
                });
            } else {
                alert('Nenhuma documentação Swagger para copiar.');
            }
        }

        function downloadSwagger() {
            var swaggerContent = document.getElementById('swaggerOutput').textContent;
            if (swaggerContent && swaggerContent.trim()) {
                var apiName = currentConfig.apiName.toLowerCase().replace(/\s+/g, '_') || 'api';
                var fileName = 'swagger_' + apiName + '.json';
                
                try {
                    var blob = new Blob([swaggerContent], { type: 'application/json' });
                    var url = URL.createObjectURL(blob);
                    var a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    alert('Download do Swagger realizado com sucesso!');
                } catch (e) {
                    alert('Erro no download. Copie o conteúdo manualmente.');
                }
            } else {
                alert('Primeiro gere o código e visualize o Swagger.');
            }
        }

        function updateStatistics(config, code) {
            var lines = code.split('\n').length;
            var methods = 0;
            if (config.operations.getUnico) methods++;
            if (config.operations.getTodos) methods++;
            if (config.operations.post) methods++;
            if (config.operations.put) methods++;
            if (config.operations.delete) methods++;
            
            var timeEstimate = Math.round(methods * 0.5 * 10) / 10;
            
            document.getElementById('linesCount').textContent = lines;
            document.getElementById('methodsCount').textContent = methods;
            document.getElementById('timeEstimate').textContent = timeEstimate + 'h';
        }

        function updateFileStructure(config) {
            var apiName = config.apiName.toLowerCase().replace(/\s+/g, '_') || 'api';
            var structure = '<i class="bi bi-folder"></i> src/<br>';
            structure += '&nbsp;&nbsp;<i class="bi bi-file-earmark-code"></i> api_' + apiName + '.tlpp<br>';
            
            if (config.includeDoc) {
                structure += '&nbsp;&nbsp;<i class="bi bi-file-earmark-text"></i> swagger_' + apiName + '.json<br>';
            }
            
            structure += '&nbsp;&nbsp;<i class="bi bi-file-earmark"></i> components_' + apiName + '.tlpp';
            
            document.getElementById('fileStructure').innerHTML = structure;
        }

        function escapeHtml(text) {
            var map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function copyCode() {
            var codeElement = document.querySelector('#codeOutput pre');
            if (codeElement && codeElement.textContent.trim()) {
                navigator.clipboard.writeText(codeElement.textContent).then(function() {
                    alert('Código copiado para a área de transferência!');
                }).catch(function() {
                    alert('Erro ao copiar. Selecione o código manualmente.');
                });
            } else {
                alert('Primeiro gere o código clicando em "Gerar Código TLPP"');
            }
        }

        function downloadCode() {
            var codeElement = document.querySelector('#codeOutput pre');
            if (codeElement && codeElement.textContent.trim()) {
                var config = {
                    apiName: document.getElementById('apiName').value
                };
                var apiName = config.apiName.toLowerCase().replace(/\s+/g, '_') || 'api';
                var fileName = 'api_' + apiName + '.tlpp';
                var codeContent = codeElement.textContent;
                
                try {
                    var blob = new Blob([codeContent], { type: 'text/plain' });
                    var url = URL.createObjectURL(blob);
                    var a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    alert('Download realizado com sucesso!');
                } catch (e) {
                    alert('Erro no download. Copie o código manualmente.');
                }
            } else {
                alert('Primeiro gere o código clicando em "Gerar Código TLPP"');
            }
        }

        function carregarTemplate(tipo) {
            if (tipo === 'produto') {
                document.getElementById('apiName').value = 'Produtos';
                document.getElementById('endpoint').value = '/api/v1/produtos';
                document.getElementById('description').value = 'API para gerenciamento de produtos';
                document.getElementById('mainTable').value = 'SB1';
                document.getElementById('execAutoRotina').value = 'MATA010';
                document.getElementById('mvcModelo').value = 'MATA010';
                document.getElementById('mvcSubModelo').value = 'SB1MASTER';
                document.getElementById('fields').value = 'B1_COD\nB1_DESC\nB1_UM\nB1_GRUPO\nB1_TIPO';
            } else if (tipo === 'cliente') {
                document.getElementById('apiName').value = 'Clientes';
                document.getElementById('endpoint').value = '/api/v1/clientes';
                document.getElementById('description').value = 'API para gerenciamento de clientes';
                document.getElementById('mainTable').value = 'SA1';
                document.getElementById('execAutoRotina').value = 'MATA030';
                document.getElementById('mvcModelo').value = 'MATA030';
                document.getElementById('mvcSubModelo').value = 'SA1MASTER';
                document.getElementById('fields').value = 'A1_COD\nA1_NOME\nA1_CGC\nA1_EMAIL\nA1_TEL';
            } else if (tipo === 'pedido') {
                document.getElementById('apiName').value = 'Pedidos';
                document.getElementById('endpoint').value = '/api/v1/pedidos';
                document.getElementById('description').value = 'API para gerenciamento de pedidos de venda';
                document.getElementById('mainTable').value = 'SC5';
                document.getElementById('execAutoRotina').value = 'MATA410';
                document.getElementById('mvcModelo').value = 'MATA410';
                document.getElementById('mvcSubModelo').value = 'SC5MASTER';
                document.getElementById('fields').value = 'C5_NUM\nC5_CLIENTE\nC5_EMISSAO\nC5_TOTAL\nC5_STATUS';
            } else if (tipo === 'fornecedor') {
                document.getElementById('apiName').value = 'Fornecedores';
                document.getElementById('endpoint').value = '/api/v1/fornecedores';
                document.getElementById('description').value = 'API para gerenciamento de fornecedores';
                document.getElementById('mainTable').value = 'SA2';
                document.getElementById('execAutoRotina').value = 'MATA020';
                document.getElementById('mvcModelo').value = 'MATA020';
                document.getElementById('mvcSubModelo').value = 'SA2MASTER';
                document.getElementById('fields').value = 'A2_COD\nA2_NOME\nA2_CGC\nA2_EMAIL\nA2_TEL';
            }
            
            document.getElementById('opGetUnico').checked = true;
            document.getElementById('opGetTodos').checked = true;
            document.getElementById('opPost').checked = true;
            document.getElementById('opPut').checked = true;
            document.getElementById('opDelete').checked = false;
            
            generateCode();
        }

        document.addEventListener('DOMContentLoaded', function() {
            toggleGravacaoOptions();
            generateCode();
        });
    </script>
</body>
</html>
