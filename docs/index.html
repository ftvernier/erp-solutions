<!DOCTYPE html> <html lang="pt-BR"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Gerador de APIs TLPP - Protheus</title> <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"> <style> .code-output { background: #2d3748; color: #e2e8f0; font-family: 'Courier New', monospace; border-radius: 8px; max-height: 600px; overflow-y: auto; overflow-x: hidden; word-wrap: break-word; white-space: pre-wrap; } .code-output pre { margin: 0; padding: 1rem; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word; } .form-section { background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; } .header-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; } .method-badge { font-size: 0.7rem; padding: 0.2rem 0.4rem; } .author-info { background: linear-gradient(45deg, #4ecdc4, #44a08d); color: white; padding: 1rem; border-radius: 8px; text-align: center; } </style> </head> <body class="bg-light"> <div class="container-fluid py-4"> <div class="header-gradient text-center py-4 rounded mb-4"> <h1 class="display-4 fw-bold mb-2"> <i class="bi bi-code-slash"></i> Gerador de APIs Protheus </h1> <p class="lead mb-0">Crie APIs REST modernas com TLPP e annotations</p> </div> <!-- Info do Desenvolvedor --> <div class="row mb-4"> <div class="col-12"> <div class="author-info"> <h5 class="mb-2"> <i class="bi bi-person-circle"></i> Desenvolvido por: Fernando Vernier </h5> <p class="mb-0"> <i class="bi bi-linkedin"></i> <a href="https://www.linkedin.com/in/fernando-v-10758522/" target="_blank" class="text-white text-decoration-none"> https://www.linkedin.com/in/fernando-v-10758522/ </a> </p> </div> </div> </div> <div class="row"> <!-- Formulário --> <div class="col-md-5"> <div class="form-section p-4 mb-4"> <h3 class="mb-3"><i class="bi bi-gear"></i> Configurações da API</h3> <div class="mb-3"> <label class="form-label fw-bold">Nome da API</label> <input type="text" class="form-control" id="apiName" placeholder="Ex: Produtos" value="Produtos"> </div> <!-- Operações REST --> <div class="mb-3"> <label class="form-label fw-bold">Operações REST</label> <div class="row"> <div class="col-6"> <div class="form-check"> <input class="form-check-input" type="checkbox" id="opGetUnico"> <label class="form-check-label" for="opGetUnico"> <span class="badge bg-primary method-badge">GET</span> Único </label> </div> <div class="form-check"> <input class="form-check-input" type="checkbox" id="opGetTodos" checked> <label class="form-check-label" for="opGetTodos"> <span class="badge bg-info method-badge">GET</span> Todos + Paginação </label> </div> </div> <div class="col-6"> <div class="form-check"> <input class="form-check-input" type="checkbox" id="opPost"> <label class="form-check-label" for="opPost"> <span class="badge bg-success method-badge">POST</span> Criar </label> </div> <div class="form-check"> <input class="form-check-input" type="checkbox" id="opPut"> <label class="form-check-label" for="opPut"> <span class="badge bg-warning method-badge">PUT</span> Alterar </label> </div> <div class="form-check"> <input class="form-check-input" type="checkbox" id="opDelete"> <label class="form-check-label" for="opDelete"> <span class="badge bg-danger method-badge">DELETE</span> Excluir </label> </div> </div> </div> </div> <div class="mb-3"> <label class="form-label fw-bold">Endpoint Base</label> <input type="text" class="form-control" id="endpoint" placeholder="/api/v1/produtos" value="/api/v1/produtos"> </div> <div class="mb-3"> <label class="form-label fw-bold">Descrição</label> <textarea class="form-control" id="description" rows="2" placeholder="Descreva o que esta API faz">API para gerenciamento de produtos</textarea> </div> <div class="mb-3"> <label class="form-label fw-bold">Tabela Principal</label> <input type="text" class="form-control" id="mainTable" placeholder="Ex: SB1" value="SB1"> </div> <!-- Método de Gravação --> <div class="mb-3" id="gravacaoSection"> <label class="form-label fw-bold">Método de Gravação</label> <select class="form-select" id="gravacaoTipo" onchange="toggleGravacaoOptions()"> <option value="msexecauto">MSExecAuto (Recomendado)</option> <option value="mvc">MVC (Moderno)</option> <option value="reclock">RecLock (Manual)</option> </select> </div> <div class="mb-3" id="execAutoSection"> <label class="form-label fw-bold">Nome da Rotina ExecAuto</label> <input type="text" class="form-control" id="execAutoRotina" placeholder="Ex: MATA010, MATA030, MATA410" value="MATA010"> <div class="form-text">Informe o nome da rotina que será utilizada no MSExecAuto (ex: MATA010 para produtos)</div> </div> <div class="mb-3" id="mvcSection" style="display: none;"> <div class="border rounded p-3" style="background-color: #f8f9fa;"> <h6 class="fw-bold text-primary mb-3"><i class="bi bi-diagram-3"></i> Configurações MVC</h6> <div class="mb-3"> <label class="form-label fw-bold">Nome do Modelo</label> <input type="text" class="form-control" id="mvcModelo" placeholder="Ex: MATA010, MATA030, MATA410" value="MATA010"> <div class="form-text">Nome do modelo que será carregado com FwLoadModel()</div> </div> <div class="mb-3"> <label class="form-label fw-bold">SubModelo Master</label> <input type="text" class="form-control" id="mvcSubModelo" placeholder="Ex: SB1MASTER, SA1MASTER, SC5MASTER" value="SB1MASTER"> <div class="form-text">Nome do submodelo principal (Master)</div> </div> <div class="form-check"> <input class="form-check-input" type="checkbox" id="mvcHasDetail" onchange="toggleDetailSection()"> <label class="form-check-label" for="mvcHasDetail"> Possui SubModelo Detail (itens, produtos alternativos, etc.) </label> </div> <div class="mb-3 mt-3" id="mvcDetailSection" style="display: none;"> <label class="form-label fw-bold">Nome do SubModelo Detail</label> <input type="text" class="form-control" id="mvcSubModeloDetail" placeholder="Ex: SGIDETAIL, SC6DETAIL, SE1DETAIL" value=""> <div class="form-text">Nome do submodelo de detalhes/itens (se houver)</div> </div> </div> </div> <div class="mb-3"> <label class="form-label fw-bold">Campos (um por linha)</label> <textarea class="form-control" id="fields" rows="4" placeholder="B1_COD&#10;B1_DESC&#10;B1_UM">B1_COD B1_DESC B1_UM B1_GRUPO</textarea> </div> <div class="mb-3"> <label class="form-label fw-bold">Autor</label> <input type="text" class="form-control" id="author" placeholder="Seu nome" value="Fernando Vernier"> </div> <div class="mb-3"> <div class="form-check"> <input class="form-check-input" type="checkbox" id="includePaginacao" checked> <label class="form-check-label" for="includePaginacao"> Paginação inteligente </label> </div> </div> <div class="form-check mb-3"> <input class="form-check-input" type="checkbox" id="includeDoc" checked> <label class="form-check-label" for="includeDoc"> Gerar documentação Swagger </label> </div> <button class="btn btn-primary btn-lg w-100" onclick="generateCode()"> <i class="bi bi-magic"></i> Gerar Código TLPP </button> </div> <!-- Templates --> <div class="form-section p-4"> <h4 class="mb-3"><i class="bi bi-file-code"></i> Templates Prontos</h4> <div class="d-grid gap-2"> <button class="btn btn-outline-primary" onclick="carregarTemplate('produto')"> <i class="bi bi-box"></i> API de Produtos (SB1) </button> <button class="btn btn-outline-success" onclick="carregarTemplate('cliente')"> <i class="bi bi-person"></i> API de Clientes (SA1) </button> <button class="btn btn-outline-warning" onclick="carregarTemplate('pedido')"> <i class="bi bi-cart"></i> API de Pedidos (SC5) </button> <button class="btn btn-outline-info" onclick="carregarTemplate('fornecedor')"> <i class="bi bi-building"></i> API de Fornecedores (SA2) </button> </div> </div> </div> <!-- Código Gerado --> <div class="col-md-7"> <div class="mb-3"> <h3><i class="bi bi-file-earmark-code"></i> Código TLPP Gerado</h3> <div class="btn-group" role="group"> <button class="btn btn-outline-secondary btn-sm" onclick="copyCode()"> <i class="bi bi-clipboard"></i> Copiar </button> <button class="btn btn-outline-primary btn-sm" onclick="downloadCode()"> <i class="bi bi-download"></i> Download </button> <button class="btn btn-outline-success btn-sm" onclick="showSwagger()"> <i class="bi bi-book"></i> Ver Swagger </button> </div> </div> <div class="code-output" id="codeOutput"> <pre>Clique em "Gerar Código TLPP" para ver o resultado...</pre> </div> <!-- Estatísticas --> <div class="mt-4"> <div class="row"> <div class="col-md-4"> <div class="card text-center"> <div class="card-body"> <h5 class="card-title text-primary" id="linesCount">0</h5> <p class="card-text small">Linhas de Código</p> </div> </div> </div> <div class="col-md-4"> <div class="card text-center"> <div class="card-body"> <h5 class="card-title text-success" id="methodsCount">0</h5> <p class="card-text small">Métodos REST</p> </div> </div> </div> <div class="col-md-4"> <div class="card text-center"> <div class="card-body"> <h5 class="card-title text-warning" id="timeEstimate">0h</h5> <p class="card-text small">Tempo Economizado</p> </div> </div> </div> </div> </div> <!-- Estrutura de arquivos --> <div class="mt-4"> <h4><i class="bi bi-diagram-2"></i> Estrutura de Arquivos</h4> <div class="card"> <div class="card-body"> <div class="text-muted small" id="fileStructure"> <i class="bi bi-folder"></i> src/<br> &nbsp;&nbsp;<i class="bi bi-file-earmark-code"></i> api_produtos.tlpp<br> &nbsp;&nbsp;<i class="bi bi-file-earmark-text"></i> api_produtos_doc.tlpp<br> &nbsp;&nbsp;<i class="bi bi-file-earmark"></i> components_produtos.tlpp </div> </div> </div> </div> </div> </div> </div> <!-- Modal Swagger --> <div class="modal fade" id="swaggerModal" tabindex="-1"> <div class="modal-dialog modal-xl"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title">Documentação Swagger Gerada</h5> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <pre class="code-output p-3" id="swaggerOutput"></pre> </div> </div> </div> </div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> <script> function toggleGravacaoOptions() { var tipo = document.getElementById('gravacaoTipo').value; var execAutoSection = document.getElementById('execAutoSection'); var mvcSection = document.getElementById('mvcSection'); execAutoSection.style.display = 'none'; mvcSection.style.display = 'none'; if (tipo === 'msexecauto') { execAutoSection.style.display = 'block'; } else if (tipo === 'mvc') { mvcSection.style.display = 'block'; } } function toggleDetailSection() { var hasDetail = document.getElementById('mvcHasDetail').checked; var detailSection = document.getElementById('mvcDetailSection'); detailSection.style.display = hasDetail ? 'block' : 'none'; } function generateCode() { var config = { apiName: document.getElementById('apiName').value, endpoint: document.getElementById('endpoint').value, description: document.getElementById('description').value, mainTable: document.getElementById('mainTable').value, gravacaoTipo: document.getElementById('gravacaoTipo').value, execAutoRotina: document.getElementById('execAutoRotina').value, mvcModelo: document.getElementById('mvcModelo').value, mvcSubModelo: document.getElementById('mvcSubModelo').value, mvcHasDetail: document.getElementById('mvcHasDetail').checked, mvcSubModeloDetail: document.getElementById('mvcSubModeloDetail').value, fields: document.getElementById('fields').value.split('\n').filter(function(f) { return f.trim(); }), author: document.getElementById('author').value, operations: { getUnico: document.getElementById('opGetUnico').checked, getTodos: document.getElementById('opGetTodos').checked, post: document.getElementById('opPost').checked, put: document.getElementById('opPut').checked, delete: document.getElementById('opDelete').checked }, includePaginacao: document.getElementById('includePaginacao').checked, includeDoc: document.getElementById('includeDoc').checked }; var code = generateTLPPCode(config); document.getElementById('codeOutput').innerHTML = '<pre>' + escapeHtml(code) + '</pre>'; updateStatistics(config, code); } function generateTLPPCode(config) { var date = new Date().toLocaleDateString('pt-BR'); var code = '#Include "tlpp-core.th"\n#Include "tlpp-rest.th"'; if (config.includeDoc) { code += '\n#Include "tlpp-doc.th"'; } if (config.gravacaoTipo === 'mvc') { code += '\n#Include "FWMVCDef.ch"'; } code += '\n\n/*/{Protheus.doc} ' + config.apiName + 'API\n'; code += config.description + '\n'; code += '@author ' + config.author + '\n'; code += '@since ' + date + '\n'; code += '@version 1.0\n'; code += '@type class\n'; code += '/*/\n\n'; code += 'Using Namespace tlpp.core\n\n'; code += 'Class ' + config.apiName + 'API\n'; code += ' Public Method New() Constructor'; if (config.operations.getUnico) { code += '\n Public Method GetById()'; } if (config.operations.getTodos) { code += '\n Public Method GetAll()'; } if (config.operations.post) { code += '\n Public Method Post()'; } if (config.operations.put) { code += '\n Public Method Put()'; } if (config.operations.delete) { code += '\n Public Method Delete()'; } code += '\nEndClass\n\n'; code += 'Method New() Class ' + config.apiName + 'API\n'; code += 'Return Self'; if (config.operations.getTodos) { code += generateGetAllMethod(config); } if (config.operations.post) { code += generatePostMethod(config); } return code; } function generateGetAllMethod(config) { var method = '\n\n/*/{Protheus.doc} GetAll\n'; method += 'Busca todos os registros com paginação\n'; method += '@author ' + config.author + '\n'; method += '@since ' + new Date().toLocaleDateString('pt-BR') + '\n'; method += '@version 1.0\n'; method += '/*/\n'; method += '@Get("' + config.endpoint + '/get_all"'; if (config.includeDoc) { method += ', description="' + config.description + ' - Listagem com paginação"'; } method += ')\n'; method += 'Method GetAll() Class ' + config.apiName + 'API\n'; method += ' Local oResponse := JsonObject():New()\n'; method += ' Local cQuery := ""\n'; method += ' Local nTotal := 0\n'; method += ' Local nLimit := Val(oRest:getQueryRequest("limit"))\n'; method += ' Local nPage := Val(oRest:getQueryRequest("page"))\n'; method += ' \n'; method += ' Default nLimit := 10\n'; method += ' Default nPage := 1\n'; method += ' \n'; method += ' oResponse["success"] := .T.\n'; method += ' oResponse["message"] := "Registros encontrados"\n'; method += ' oResponse["data"] := {}\n'; method += ' \n'; method += ' oRest:SetResponse(oResponse:ToJson())\n'; method += 'Return .T.'; return method; } function generatePostMethod(config) { var method = '\n\n/*/{Protheus.doc} Post\n'; method += 'Cria um novo registro\n'; method += '@author ' + config.author + '\n'; method += '@since ' + new Date().toLocaleDateString('pt-BR') + '\n'; method += '@version 1.0\n'; method += '/*/\n'; method += '@Post("' + config.endpoint + '"'; if (config.includeDoc) { method += ', description="' + config.description + ' - Criação"'; } method += ')\n'; method += 'Method Post() Class ' + config.apiName + 'API\n'; method += ' Local oResponse := JsonObject():New()\n'; method += ' Local cBody := oRest:GetBodyRequest()\n'; method += ' Local jBody := JsonObject():New()\n'; method += ' \n'; if (config.gravacaoTipo === 'msexecauto') { method += ' // Inclusão via MSExecAuto\n'; method += ' Private lMsErroAuto := .F.\n'; method += ' Private aRotAuto := {}\n'; method += ' \n'; for (var i = 0; i < config.fields.length; i++) { method += ' aAdd(aRotAuto, {"' + config.fields[i] + '", jBody["' + config.fields[i].toLowerCase() + '"], Nil})\n'; } method += ' \n'; method += ' MSExecAuto({|x,y| ' + config.execAutoRotina + '(x,y)}, aRotAuto, 3)\n'; } else if (config.gravacaoTipo === 'mvc') { method += ' // Inclusão via MVC\n'; method += ' Local oModel := FwLoadModel("' + config.mvcModelo + '")\n'; method += ' \n'; method += ' oModel:SetOperation(MODEL_OPERATION_INSERT)\n'; method += ' oModel:Activate()\n'; method += ' \n'; for (var i = 0; i < config.fields.length; i++) { method += ' oModel:SetValue("' + config.mvcSubModelo + '", "' + config.fields[i] + '", jBody["' + config.fields[i].toLowerCase() + '"])\n'; } method += ' \n'; method += ' If oModel:VldData()\n'; method += ' oModel:CommitData()\n'; method += ' EndIf\n'; method += ' \n'; method += ' oModel:DeActivate()\n'; method += ' oModel:Destroy()\n'; } else { method += ' // Inclusão via RecLock\n'; method += ' DbSelectArea("' + config.mainTable + '")\n'; method += ' \n'; method += ' If RecLock("' + config.mainTable + '", .T.)\n'; for (var i = 0; i < config.fields.length; i++) { method += ' ' + config.mainTable + '->' + config.fields[i] + ' := jBody["' + config.fields[i].toLowerCase() + '"]\n'; } method += ' ' + config.mainTable + '->(MsUnlock())\n'; method += ' EndIf\n'; } method += ' \n'; method += ' oResponse["success"] := .T.\n'; method += ' oResponse["message"] := "Registro incluído com sucesso"\n'; method += ' oRest:SetResponse(oResponse:ToJson())\n'; method += 'Return .T.'; return method; } function updateStatistics(config, code) { var lines = code.split('\n').length; var methods = 0; if (config.operations.getUnico) methods++; if (config.operations.getTodos) methods++; if (config.operations.post) methods++; if (config.operations.put) methods++; if (config.operations.delete) methods++; var timeEstimate = Math.round(methods * 0.5 * 10) / 10; document.getElementById('linesCount').textContent = lines; document.getElementById('methodsCount').textContent = methods; document.getElementById('timeEstimate').textContent = timeEstimate + 'h'; } function escapeHtml(text) { var map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' }; return text.replace(/[&<>"']/g, function(m) { return map[m]; }); } function copyCode() { var codeElement = document.querySelector('#codeOutput pre'); if (codeElement && codeElement.textContent.trim()) { navigator.clipboard.writeText(codeElement.textContent).then(function() { alert('Código copiado para a área de transferência!'); }).catch(function() { alert('Erro ao copiar. Selecione o código manualmente.'); }); } else { alert('Primeiro gere o código clicando em "Gerar Código TLPP"'); } } function downloadCode() { var codeElement = document.querySelector('#codeOutput pre'); if (codeElement && codeElement.textContent.trim()) { var config = { apiName: document.getElementById('apiName').value }; var apiName = config.apiName.toLowerCase().replace(/\s+/g, '_') || 'api'; var fileName = 'api_' + apiName + '.tlpp'; var codeContent = codeElement.textContent; try { var blob = new Blob([codeContent], { type: 'text/plain' }); var url = URL.createObjectURL(blob); var a = document.createElement('a'); a.href = url; a.download = fileName; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); alert('Download realizado com sucesso!'); } catch (e) { alert('Erro no download. Copie o código manualmente.'); } } else { alert('Primeiro gere o código clicando em "Gerar Código TLPP"'); } } function carregarTemplate(tipo) { if (tipo === 'produto') { document.getElementById('apiName').value = 'Produtos'; document.getElementById('endpoint').value = '/api/v1/produtos'; document.getElementById('description').value = 'API para gerenciamento de produtos'; document.getElementById('mainTable').value = 'SB1'; document.getElementById('execAutoRotina').value = 'MATA010'; document.getElementById('mvcModelo').value = 'MATA010'; document.getElementById('mvcSubModelo').value = 'SB1MASTER'; document.getElementById('fields').value = 'B1_COD\nB1_DESC\nB1_UM\nB1_GRUPO\nB1_TIPO'; } else if (tipo === 'cliente') { document.getElementById('apiName').value = 'Clientes'; document.getElementById('endpoint').value = '/api/v1/clientes'; document.getElementById('description').value = 'API para gerenciamento de clientes'; document.getElementById('mainTable').value = 'SA1'; document.getElementById('execAutoRotina').value = 'MATA030'; document.getElementById('mvcModelo').value = 'MATA030'; document.getElementById('mvcSubModelo').value = 'SA1MASTER'; document.getElementById('fields').value = 'A1_COD\nA1_NOME\nA1_CGC\nA1_EMAIL\nA1_TEL'; } else if (tipo === 'pedido') { document.getElementById('apiName').value = 'Pedidos'; document.getElementById('endpoint').value = '/api/v1/pedidos'; document.getElementById('description').value = 'API para gerenciamento de pedidos de venda'; document.getElementById('mainTable').value = 'SC5'; document.getElementById('execAutoRotina').value = 'MATA410'; document.getElementById('mvcModelo').value = 'MATA410'; document.getElementById('mvcSubModelo').value = 'SC5MASTER'; document.getElementById('fields').value = 'C5_NUM\nC5_CLIENTE\nC5_EMISSAO\nC5_TOTAL\nC5_STATUS'; } else if (tipo === 'fornecedor') { document.getElementById('apiName').value = 'Fornecedores'; document.getElementById('endpoint').value = '/api/v1/fornecedores'; document.getElementById('description').value = 'API para gerenciamento de fornecedores'; document.getElementById('mainTable').value = 'SA2'; document.getElementById('execAutoRotina').value = 'MATA020'; document.getElementById('mvcModelo').value = 'MATA020'; document.getElementById('mvcSubModelo').value = 'SA2MASTER'; document.getElementById('fields').value = 'A2_COD\nA2_NOME\nA2_CGC\nA2_EMAIL\nA2_TEL'; } document.getElementById('opGetUnico').checked = true; document.getElementById('opGetTodos').checked = true; document.getElementById('opPost').checked = true; document.getElementById('opPut').checked = true; document.getElementById('opDelete').checked = false; generateCode(); } document.addEventListener('DOMContentLoaded', function() { toggleGravacaoOptions(); generateCode(); }); </script> </body> </html>
